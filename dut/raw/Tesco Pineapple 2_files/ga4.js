!function(){function ga4(){var country=gtmDataLayer.get("country")||gtmDataLayer.get("platformData.country"),uuid=gtmDataLayer.get("customerData.UUID"),firstTimeShopper=gtmDataLayer.get("customerData.firstTimeShopper"),pageTitle=gtmDataLayer.get("pageData.pageTitle"),prevPage=_gtm.prevPage(location.pathname),pageName=gtmDataLayer.get("pageData.v72"),pageType=gtmDataLayer.get("pageData.pageType"),pageURL=window.location.protocol+"//"+window.location.hostname+window.location.pathname,pagePath=window.location.pathname,globalFunctions=gtmDataLayer.get("dLPlatformFuncs")||{},siteCurrency=globalFunctions.currencyCode&&"function"==typeof globalFunctions.currencyCode?globalFunctions.currencyCode():null,globalFunctions=gtmDataLayer.get("dLGlobalFuncs.isDebugMode")(),env=gtmDataLayer.get("env")?gtmDataLayer.get("env").replace("container-",""):null,gaMeasurementId="",authStatus=gtmDataLayer.get("customerData.customerLoyalType"),amendMode="amend"==gtmDataLayer.get("customerData.amendMode")?"amending":"normal",prevPage=document.referrer.match(/^$|tesco/i)?prevPage:document.referrer,country=country&&country.toUpperCase(),gaMeasurementId=(!globalFunctions&&env.match(/pro?d/)?{UK:"G-33B19D36CY",IE:"G-YVXWF6D2Q3",SK:"G-49RN63ZG8P",CZ:"G-EZ1BJ05B45",HU:"G-SMN6XWLPM9"}:{UK:"G-DJR96F5CBD",IE:"G-JSDW3ZM9WG",SK:"G-N7FZ32E8YG",CZ:"G-BTXPWS55HH",HU:"G-1L9FPNT7J9"})[country],env={user_status:authStatus,first_time_shopper:firstTimeShopper,currency:siteCurrency,send_page_view:!1,property_name:{UK:"ghs:uk:web",IE:"ghs:ie:web",SK:"ghs:sk:web",CZ:"ghs:cz:web",HU:"ghs:hu:web"}[country],amend_mode:amendMode,referring_page:prevPage,traffic_type:globalFunctions?"internal":"production"};globalFunctions&&(env.debug_mode="true"),expCookieTrue&&(env.user_id=uuid,env.uuid=uuid,gtag("set","user_properties",{uuid:uuid})),gtag("set","page_referrer",gtmDataLayer.get("pageData.preservedReferrer")||document.referrer),gtag("config",gaMeasurementId,env),gtag("event","page_view",{page_title:pageTitle,page_location:pageURL,page_name:pageName,page_type:pageType}),/^\/groceries\/([a-zA-Z]{2})-([a-zA-Z]{2})\/products\/.*/.test(pagePath)&&(authStatus=gtmDataLayer.get("renderedContentOp.arrayOfProducts")||[])&&authStatus.length&&authStatus.forEach(function(content){var itemsData;content.panel&&content.panel.length&&(itemsData=[],content.panel.forEach(function(panel){var panel=panel&&panel.product,itemData={item_id:gtmDataLayer.get("renderedContentOp.productID"),currency:siteCurrency,index:1,item_list_name:gtmDataLayer.get("pageData.aisle")||""};panel.offer&&panel.offer.length&&panel.offer[0].offerId&&(itemData.item_category="clubcard offer"),itemsData.push(itemData)}),gtag("event","view_item",{page_title:pageTitle,page_location:pageURL,page_name:pageName,page_type:pageType,currency:siteCurrency,items:itemsData}))}),_gtm.notify("GTM: GA4 GHS fired")}function run(){"function"==typeof gtag&&"true"===gtmDataLayer.get("gtagConfigSet")?ga4():window.addEventListener("gtagConfigSet",ga4)}window.addEventListener("pageLoad",run),gtmDataLayer.get("pageLoad")&&run()}();
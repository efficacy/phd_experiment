<html><head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<title>Experiment Registry</title>
	</head>
	<body>
	<script>
	function httpGet(url, callback)
	{
		var xhr = new XMLHttpRequest();
		xhr.open("GET", url, true);
		xhr.onload = function (e) {
			callback(xhr.responseText);
		};
		xhr.send(null);
	}
	
	function catchSubmit(form, callback) {
		if (form.attachEvent) {
			form.attachEvent("submit", callback);
		} else {
			form.addEventListener("submit", callback);
		}
	}
	
	function getStatus() {
		httpGet('/status', function(text) {
			document.getElementById("status").innerHTML = text
		})
	}
	
	function remove(role, output) {
		event.preventDefault()
		fetch(`/remove?role=${role}`, {mode: 'cors'}).then((r)=>{r.text().then((s) => {
			let dest = document.getElementById(output)
			dest.innerHTML = s
			setTimeout(() => {
				dest.innerHTML = ''
				getStatus();
			}, 1000)
		})})
	}
	
	window.onload = function() {
		getStatus();
	
		var register = document.getElementById('register');
		catchSubmit(register, function(event) {
			event.preventDefault();
			var role = register.elements['role'].value
			var address = register.elements['address'].value
			if (role.trim() && address.trim()) {
				httpGet('/register?role='+role+'&address='+address, function(text) {
					document.getElementById("regout").innerHTML = text
					getStatus();
				})
			} else {
				document.getElementById("regout").innerHTML = "Please supply valid role and address"
			}
			return false
		})
	
		var lookup = document.getElementById('lookup');
		catchSubmit(lookup, function(event) {
			event.preventDefault();
			var role = lookup.elements['role'].value
			if (role.trim()) {
				httpGet('/lookup?role='+role, function(text) {
					document.getElementById("lookout").innerHTML = text
				})
			} else {
				document.getElementById("lookout").innerHTML = "Please supply valid role"
			}
			return false
		})
	
		var lease = document.getElementById('lease');
		catchSubmit(lease, function(event) {
			event.preventDefault();
			var duration = lease.elements['duration'].value
			if (duration.trim()) {
			alert(' set lease ' + duration )
				httpGet('/status?duration='+duration, function(text) {
					document.getElementById("leaseout").innerHTML = text
				})
			} else {
				document.getElementById("leaseout").innerHTML = "Please supply valid duration"
			}
			return false
		})
	
		document.getElementById('clear').addEventListener('click', event => {
			event.preventDefault()
			fetch('/clear', {mode: 'cors'}).then((r)=>{r.text().then((s) => {
				document.getElementById('clear-output').innerHTML = s
				setTimeout(() => {
					document.getElementById('clear-output').innerHTML = ''
				}, 1000)
				getStatus();
			})})
		})
	}
	</script>
	
	<div id=mode></div>
	<H1>Experiment Registry</h1>
	<div id='status'>
	</div>
	<h1>Register</h1>
	<form id='register'>
		<label for='role'>Role:</label>
		<input type='text' id='role' name='role'/>
		<label for='address'>Address:</label>
		<input type='text' id='address' name='address'/>
		<button type="submit">Submit</button>
	</form>
	<div id=regout></div>
	
	<h1>Lookup</h1>
	<form id='lookup'>
		<label for='role'>Role:</label>
		<input type='text' id='role' name='role'/>
		<button type="submit">Submit</button>
	</form>
	<div id=lookout></div>
	
	<h1>Set Default Lease</h1>
	<form id='lease'>
		<label for='duration'>Duration:</label>
		<input type='text' id='duration' name='duration'/>
		<button type="submit">Submit</button>
	</form>
	<div id=leaseout></div>
	
	<h1>General Operations</h1>
	<ul>
		<li><a href='#' id='clear'>Clear Lease Table</a> <span id='clear-output'></span></li>
	</ul>
	
	</body>
</html>